<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Geheimes Wort â€“ Hinweisrunde</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    .card { padding: 16px; border: 1px solid #ddd; border-radius: 10px; margin: 14px 0; }
    .role { font-size: 18px; font-weight: bold; }
    .word { font-size: 22px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ðŸ”Ž Hinweisrunde</h1>

  <div id="info" class="card">Lade...</div>
  <div id="view" class="card" style="display:none;">
    <p class="role" id="rolleText"></p>
    <p id="wortBlock" style="display:none;">Gemeinsames Wort: <span class="word" id="wortText"></span></p>
  </div>

  <!-- Firebase -->
  <script type="module" src="./firebase.js"></script>
  <script type="module">
    import { doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { db } from "./firebase.js";

    const SPIEL_ID = "hauptspiel";
    const userId = localStorage.getItem("userId");
    if (!userId) { alert("Keine Benutzer-ID. ZurÃ¼ck zur Lobby."); location.href = "index.html"; }

    const spielRef = doc(db, "spiele", SPIEL_ID);
    const meinRef = doc(db, "spiele", SPIEL_ID, "spieler", userId);

    async function init() {
      // Warte, bis Rolle da ist
      const meinDoc = await getDoc(meinRef);
      const info = document.getElementById("info");
      const view = document.getElementById("view");

      if (!meinDoc.exists() || !meinDoc.data()?.rolle) {
        info.textContent = "Warte auf Rollenvergabe...";
      } else {
        info.style.display = "none";
        view.style.display = "block";
      }

      // Live auf Spiel- & Rollen-Ã„nderungen hÃ¶ren
      onSnapshot(spielRef, async (snap) => {
        const data = snap.data() || {};
        const phase = data.phase;
        const wort = data.wort;

        const meinSnap = await getDoc(meinRef);
        const rolle = meinSnap.data()?.rolle || "unbekannt";

        document.getElementById("rolleText").textContent =
          rolle === "impostor" ? "ðŸŸ¥ Deine Rolle: Impostor" : "ðŸŸ© Deine Rolle: Innocent";

        // Wort nur fÃ¼r Innocents anzeigen
        const wortBlock = document.getElementById("wortBlock");
        if (rolle === "innocent" && wort) {
          wortBlock.style.display = "block";
          document.getElementById("wortText").textContent = wort;
        } else {
          wortBlock.style.display = "none";
        }

        if (phase !== "hinweisrunde") {
          // (z. B. falls jemand zurÃ¼ckstellt)
          // optional navigieren
        }
      });
    }
    init();
  </script>
</body>
</html>
